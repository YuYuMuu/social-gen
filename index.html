<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SocialGen 0.2.1 Pro - Interactive Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f3f4f6; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .logo-font { font-family: 'Outfit', sans-serif; background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .canvas-container { box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
        
        #mainCanvas { cursor: move; touch-action: none; }
        
        .stepper-container { position: relative; padding-left: 56px; }
        
        .progress-line { 
            width: 3px; 
            background: #e5e7eb; 
            position: absolute; 
            left: 19px; 
            top: 20px; 
            bottom: 20px; 
            z-index: 0; 
            border-radius: 4px;
        }
        
        .progress-fill { 
            width: 3px; 
            background: #4f46e5; 
            position: absolute; 
            left: 19px; 
            top: 20px; 
            height: 0%; 
            transition: height 0.6s cubic-bezier(0.4, 0, 0.2, 1); 
            z-index: 1; 
            border-radius: 4px;
        }

        .step-indicator { 
            width: 40px; 
            height: 40px; 
            border-radius: 50%; 
            background: #e5e7eb; 
            color: #9ca3af; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: 800; 
            font-size: 0.85rem; 
            transition: all 0.4s ease; 
            position: absolute; 
            left: -56px; 
            top: 0; 
            z-index: 10; 
            border: 4px solid #f3f4f6; 
        }
        
        .step-active { 
            background-color: #4f46e5 !important; 
            color: white !important; 
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2);
        }

        .btn-disabled { background-color: #d1d5db !important; color: #9ca3af !important; cursor: not-allowed; opacity: 0.7; }
        
        input[type="range"] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type="range"]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #e5e7eb; border-radius: 2px; }
        input[type="range"]::-webkit-slider-thumb { height: 16px; width: 16px; border-radius: 50%; background: #4f46e5; -webkit-appearance: none; margin-top: -6px; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        .align-btn {
            border: 2px solid #e5e7eb;
            color: #6b7280;
            background: white;
            transition: all 0.2s ease;
        }
        .align-btn.active {
            background-color: #4f46e5;
            color: white;
            border-color: #4f46e5;
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.2);
        }
        .align-btn.active .dot { background-color: white; }

        .media-btn-success {
            background-color: #4f46e5 !important;
            border-color: #4f46e5 !important;
            animation: mediaPulse 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .media-btn-success span { color: white !important; }
        .media-btn-success .check-icon { display: flex !important; }

        @keyframes mediaPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="flex flex-col items-center p-4 min-h-screen">

    <header class="w-full max-w-6xl text-center md:text-left mb-10 pt-6 px-4">
        <div class="inline-flex items-center gap-2 mb-1">
            <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-black">S</div>
            <h1 class="text-3xl font-extrabold logo-font">SocialGen</h1>
        </div>
        <p class="text-gray-500 text-[10px] font-bold uppercase tracking-widest">Studio Pro • v0.2.1-PRO</p>
    </header>

    <main class="w-full max-w-6xl grid grid-cols-1 md:grid-cols-12 gap-12 mb-20">
        <!-- Aperçu du Canvas -->
        <section class="md:col-span-5 w-full relative md:sticky top-4 self-start">
            <div class="canvas-container bg-white rounded-2xl overflow-hidden border border-gray-100">
                <div class="bg-gray-50 p-3 border-b text-center">
                    <span id="formatLabel" class="text-[11px] font-bold text-gray-400 tracking-widest uppercase">Format carré (1080x1080)</span>
                </div>
                <div class="flex items-center justify-center p-4 bg-gray-100 overflow-hidden select-none">
                    <canvas id="mainCanvas" width="1080" height="1080" class="max-w-full h-auto shadow-2xl rounded-sm"></canvas>
                </div>
                <div class="bg-white p-6 border-t space-y-4">
                    <button type="button" id="downloadBtn" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold transition-all shadow-xl flex flex-col items-center justify-center btn-disabled hover:bg-indigo-700 active:scale-[0.98]">
                        <span class="flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                            Exporter le visuel
                        </span>
                        <span id="exportSubtext" class="text-[9px] opacity-70 uppercase mt-1 tracking-tighter">JPG Haute Qualité + Métadonnées</span>
                    </button>
                    <p id="errorMsg" class="text-[10px] text-red-500 font-bold text-center uppercase tracking-tighter">Configuration incomplète (Image + Titre requis)</p>
                </div>
            </div>
        </section>

        <!-- Formulaire de création -->
        <section class="md:col-span-7 stepper-container">
            <div class="progress-line"></div>
            <div id="progressFill" class="progress-fill"></div>

            <div class="space-y-16">
                <!-- Étape 1: Format -->
                <div class="relative min-h-[140px]">
                    <div class="step-indicator step-active">1</div>
                    <div class="space-y-6">
                        <h2 class="text-xs font-black text-gray-400 tracking-[0.2em] border-b border-gray-100 pb-3 uppercase">Format de sortie</h2>
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-2">
                            <button type="button" data-w="1080" data-h="1080" data-label="Carre" class="format-btn p-3 border-2 border-indigo-600 bg-indigo-50 rounded-xl text-[10px] font-bold text-indigo-700 transition-all">Carré</button>
                            <button type="button" data-w="1080" data-h="1350" data-label="Portrait" class="format-btn p-3 border-2 border-gray-200 rounded-xl text-[10px] font-bold text-gray-500 transition-all">Portrait 4:5</button>
                            <button type="button" data-w="1080" data-h="1920" data-label="Story" class="format-btn p-3 border-2 border-gray-200 rounded-xl text-[10px] font-bold text-gray-500 transition-all">Story</button>
                            <button type="button" data-w="1200" data-h="630" data-label="Banniere" class="format-btn p-3 border-2 border-gray-200 rounded-xl text-[10px] font-bold text-gray-500 transition-all">Bannière</button>
                        </div>
                    </div>
                </div>

                <!-- Étape 2: Médias -->
                <div class="relative min-h-[140px]">
                    <div id="ind2" class="step-indicator">2</div>
                    <div class="space-y-6">
                        <h2 class="text-xs font-black text-gray-400 tracking-[0.2em] border-b border-gray-100 pb-3 uppercase">Médias et recadrage</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <button type="button" id="bgBtn" onclick="document.getElementById('bgInput').click()" class="flex flex-col items-center justify-center p-5 bg-white border-2 border-dashed border-gray-200 rounded-2xl hover:border-indigo-400 transition-all group relative overflow-hidden">
                                <span class="text-[10px] font-bold text-gray-400 uppercase group-hover:text-indigo-500 transition-colors">Image de fond *</span>
                                <div id="bgCheck" class="check-icon mt-2 hidden text-white font-bold text-[10px] items-center gap-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                                    Validé
                                </div>
                                <input type="file" id="bgInput" accept="image/*" class="hidden">
                            </button>
                            <button type="button" id="logoBtn" onclick="document.getElementById('logoInput').click()" class="flex flex-col items-center justify-center p-5 bg-white border-2 border-dashed border-gray-200 rounded-2xl hover:border-indigo-400 transition-all group relative overflow-hidden">
                                <span class="text-[10px] font-bold text-gray-400 uppercase group-hover:text-indigo-500 transition-colors">Logo PNG</span>
                                <div id="logoCheck" class="check-icon mt-2 hidden text-white font-bold text-[10px] items-center gap-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                                    Validé
                                </div>
                                <input type="file" id="logoInput" accept="image/*" class="hidden">
                            </button>
                        </div>
                        
                        <div class="p-6 bg-white rounded-2xl border border-gray-100 shadow-sm space-y-6">
                            <div class="grid grid-cols-2 gap-6">
                                <div class="space-y-3">
                                    <div class="flex justify-between font-bold text-[9px] text-gray-400 uppercase"><span>Zoom Image</span><span id="zoomVal" class="text-indigo-600">1.0x</span></div>
                                    <input type="range" id="zoomInput" min="1" max="3" step="0.01" value="1">
                                </div>
                                <div class="space-y-3">
                                    <div class="flex justify-between font-bold text-[9px] text-gray-400 uppercase"><span>Opacité Noir</span><span id="gradVal" class="text-indigo-600">70%</span></div>
                                    <input type="range" id="gradOpacity" min="0" max="1" step="0.01" value="0.7">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-6">
                                <div class="space-y-3">
                                    <div class="flex justify-between font-bold text-[9px] text-gray-400 uppercase"><span>Déplacement Horizontal</span><span id="xVal" class="text-indigo-600">0</span></div>
                                    <input type="range" id="posX" min="-1000" max="1000" step="1" value="0">
                                </div>
                                <div class="space-y-3">
                                    <div class="flex justify-between font-bold text-[9px] text-gray-400 uppercase"><span>Déplacement Vertical</span><span id="yVal" class="text-indigo-600">0</span></div>
                                    <input type="range" id="posY" min="-1000" max="1000" step="1" value="0">
                                </div>
                            </div>
                            <div class="space-y-3">
                                <div class="flex justify-between font-bold text-[9px] text-gray-400 uppercase"><span>Lueur Noire (Étendu)</span><span id="spreadVal" class="text-indigo-600">60%</span></div>
                                <input type="range" id="gradSpread" min="0.1" max="0.9" step="0.01" value="0.6">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Étape 3: Textes -->
                <div class="relative min-h-[140px]">
                    <div id="ind3" class="step-indicator">3</div>
                    <div class="space-y-6">
                        <h2 class="text-xs font-black text-gray-400 tracking-[0.2em] border-b border-gray-100 pb-3 uppercase">Textes et position verticale</h2>
                        <input type="text" id="titleInput" placeholder="TITRE PRINCIPAL..." class="w-full p-4 bg-white border border-gray-200 rounded-xl font-bold text-lg focus:border-indigo-500 outline-none">
                        <textarea id="subtitleInput" placeholder="SOUS-TITRE..." rows="2" class="w-full p-4 bg-white border border-gray-200 rounded-xl text-sm focus:border-indigo-500 outline-none"></textarea>
                        
                        <div class="space-y-2">
                            <label class="text-[9px] font-black text-gray-400 uppercase ml-1">Position du bloc texte</label>
                            <div class="flex gap-2">
                                <button type="button" id="alignVCenter" class="align-btn flex-1 py-4 rounded-xl text-[10px] font-bold uppercase transition-all flex flex-col items-center justify-center gap-2">
                                    <div class="flex flex-col gap-[2px] items-center mb-1">
                                        <div class="dot w-1 h-1 rounded-full bg-gray-300 transition-colors"></div>
                                        <div class="dot w-1.5 h-1.5 rounded-full bg-indigo-500 transition-colors"></div>
                                        <div class="dot w-1 h-1 rounded-full bg-gray-300 transition-colors"></div>
                                    </div>
                                    Centré
                                </button>
                                <button type="button" id="alignVBottom" class="align-btn active flex-1 py-4 rounded-xl text-[10px] font-bold uppercase transition-all flex flex-col items-center justify-center gap-2">
                                    <div class="flex flex-col gap-[2px] items-center mb-1">
                                        <div class="dot w-1 h-1 rounded-full bg-gray-300 transition-colors"></div>
                                        <div class="dot w-1 h-1 rounded-full bg-gray-300 transition-colors"></div>
                                        <div class="dot w-1.5 h-1.5 rounded-full bg-indigo-500 transition-colors"></div>
                                    </div>
                                    Bas
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Étape 4: Métadonnées & Signature -->
                <div class="relative">
                    <div id="ind4" class="step-indicator">4</div>
                    <div class="space-y-4">
                        <h2 class="text-xs font-black text-gray-400 tracking-[0.2em] border-b border-gray-100 pb-3 uppercase">Métadonnées d'export</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <input type="text" id="metaAuthor" placeholder="Auteur (Copyright)..." class="w-full p-3 bg-white border border-gray-200 rounded-lg text-xs outline-none focus:border-indigo-500">
                            <input type="text" id="metaKeywords" placeholder="Mots-clés (séparés par virgules)..." class="w-full p-3 bg-white border border-gray-200 rounded-lg text-xs outline-none focus:border-indigo-500">
                        </div>
                        <input type="text" id="metaAlt" placeholder="Texte Alternatif (pour accessibilité)..." class="w-full p-3 bg-white border border-gray-200 rounded-lg text-xs outline-none focus:border-indigo-500">
                        <textarea id="metaDesc" placeholder="Description de l'image..." rows="2" class="w-full p-3 bg-white border border-gray-200 rounded-lg text-xs outline-none focus:border-indigo-500"></textarea>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const progressFill = document.getElementById('progressFill');
        const downloadBtn = document.getElementById('downloadBtn');

        const state = {
            backgroundImage: null,
            logoImage: null,
            title: "",
            subtitle: "",
            zoom: 1,
            posX: 0,
            posY: 0,
            gradOpacity: 0.7,
            gradSpread: 0.6,
            isBottomV: true,
            formatName: 'Carre',
            meta: { 
                author: "",
                keywords: "",
                description: "",
                alt: ""
            },
            isDragging: false,
            lastMouseX: 0,
            lastMouseY: 0
        };

        function clampPositions() {
            if (!state.backgroundImage) return;
            const ratio = Math.max(canvas.width / state.backgroundImage.width, canvas.height / state.backgroundImage.height) * state.zoom;
            const imgW = state.backgroundImage.width * ratio;
            const imgH = state.backgroundImage.height * ratio;
            const maxX = Math.max(0, (imgW - canvas.width) / 2);
            const maxY = Math.max(0, (imgH - canvas.height) / 2);
            state.posX = Math.max(-maxX, Math.min(maxX, state.posX));
            state.posY = Math.max(-maxY, Math.min(maxY, state.posY));
            const inputX = document.getElementById('posX');
            const inputY = document.getElementById('posY');
            inputX.min = -maxX; inputX.max = maxX; inputX.value = state.posX;
            inputY.min = -maxY; inputY.max = maxY; inputY.value = state.posY;
            document.getElementById('xVal').innerText = Math.round(state.posX);
            document.getElementById('yVal').innerText = Math.round(state.posY);
        }

        function updateUI() {
            let score = 15;
            const indicators = document.querySelectorAll('.step-indicator');
            indicators.forEach(i => i.classList.remove('step-active'));
            indicators[0].classList.add('step-active');
            if (state.backgroundImage) { score = 40; indicators[1].classList.add('step-active'); }
            if (state.backgroundImage && state.title) { score = 70; indicators[2].classList.add('step-active'); }
            if (score >= 70 && state.meta.author) { score = 100; indicators[3].classList.add('step-active'); }
            progressFill.style.height = `${score}%`;
            
            if (state.backgroundImage && state.title.trim()) {
                downloadBtn.classList.remove('btn-disabled');
                document.getElementById('errorMsg').classList.add('hidden');
            } else {
                downloadBtn.classList.add('btn-disabled');
                document.getElementById('errorMsg').classList.remove('hidden');
            }
        }

        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#ffffff";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (state.backgroundImage) {
                clampPositions();
                const ratio = Math.max(canvas.width / state.backgroundImage.width, canvas.height / state.backgroundImage.height) * state.zoom;
                const w = state.backgroundImage.width * ratio;
                const h = state.backgroundImage.height * ratio;
                ctx.drawImage(state.backgroundImage, (canvas.width - w)/2 + state.posX, (canvas.height - h)/2 + state.posY, w, h);
                const gradStart = canvas.height * (1 - state.gradSpread);
                const grad = ctx.createLinearGradient(0, gradStart, 0, canvas.height);
                grad.addColorStop(0, 'rgba(0,0,0,0)');
                grad.addColorStop(1, `rgba(0,0,0,${state.gradOpacity})`);
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Textes Centrés/Bas
                ctx.fillStyle = "#ffffff";
                ctx.textAlign = "center";
                ctx.shadowColor = "rgba(0,0,0,0.6)";
                ctx.shadowBlur = 20;
                const x = canvas.width / 2;
                let y_base = state.isBottomV ? canvas.height * 0.85 : canvas.height / 2;
                const fSize = canvas.width * 0.085;
                ctx.font = `800 ${fSize}px 'Outfit'`;
                ctx.fillText(state.title.toUpperCase(), x, y_base);
                if (state.subtitle) {
                    ctx.font = `500 ${canvas.width * 0.035}px 'Inter'`;
                    ctx.fillText(state.subtitle, x, y_base + (canvas.width * 0.06));
                }

                // Inscription du copyright sur l'image
                if (state.meta.author) {
                    ctx.shadowBlur = 5;
                    ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
                    ctx.textAlign = "right";
                    ctx.font = `600 ${canvas.width * 0.015}px 'Inter'`;
                    ctx.fillText(`© ${new Date().getFullYear()} ${state.meta.author}`, canvas.width - 20, canvas.height - 20);
                }
                
                ctx.shadowBlur = 0;
            }

            if (state.logoImage) {
                const lw = canvas.width * 0.12;
                ctx.drawImage(state.logoImage, canvas.width - lw - 40, 40, lw, (state.logoImage.height * lw)/state.logoImage.width);
            }
            updateUI();
        }

        // --- Drag Logic ---
        function startDragging(x, y) {
            if (!state.backgroundImage) return;
            state.isDragging = true;
            state.lastMouseX = x;
            state.lastMouseY = y;
        }

        function moveDragging(x, y) {
            if (!state.isDragging) return;
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const dx = (x - state.lastMouseX) * scaleX;
            const dy = (y - state.lastMouseY) * scaleY;
            state.posX += dx;
            state.posY += dy;
            state.lastMouseX = x;
            state.lastMouseY = y;
            render();
        }

        function stopDragging() { state.isDragging = false; }

        canvas.addEventListener('mousedown', (e) => startDragging(e.clientX, e.clientY));
        window.addEventListener('mousemove', (e) => moveDragging(e.clientX, e.clientY));
        window.addEventListener('mouseup', stopDragging);
        canvas.addEventListener('touchstart', (e) => { const t = e.touches[0]; startDragging(t.clientX, t.clientY); }, { passive: false });
        window.addEventListener('touchmove', (e) => { const t = e.touches[0]; moveDragging(t.clientX, t.clientY); }, { passive: false });
        window.addEventListener('touchend', stopDragging);

        // --- Inputs ---
        document.getElementById('bgInput').onchange = (e) => {
            const reader = new FileReader();
            reader.onload = (ev) => {
                const img = new Image();
                img.onload = () => { 
                    state.backgroundImage = img; 
                    state.posX = 0; state.posY = 0;
                    const btn = document.getElementById('bgBtn');
                    btn.classList.add('media-btn-success');
                    document.getElementById('bgCheck').classList.remove('hidden'); 
                    render(); 
                };
                img.src = ev.target.result;
            };
            reader.readAsDataURL(e.target.files[0]);
        };

        document.getElementById('logoInput').onchange = (e) => {
            const reader = new FileReader();
            reader.onload = (ev) => {
                const img = new Image();
                img.onload = () => { 
                    state.logoImage = img; 
                    const btn = document.getElementById('logoBtn');
                    btn.classList.add('media-btn-success');
                    document.getElementById('logoCheck').classList.remove('hidden'); 
                    render(); 
                };
                img.src = ev.target.result;
            };
            reader.readAsDataURL(e.target.files[0]);
        };

        const btnVCenter = document.getElementById('alignVCenter');
        const btnVBottom = document.getElementById('alignVBottom');
        
        btnVCenter.onclick = () => { state.isBottomV = false; btnVCenter.classList.add('active'); btnVBottom.classList.remove('active'); render(); };
        btnVBottom.onclick = () => { state.isBottomV = true; btnVBottom.classList.add('active'); btnVCenter.classList.remove('active'); render(); };

        document.getElementById('zoomInput').oninput = (e) => { state.zoom = parseFloat(e.target.value); document.getElementById('zoomVal').innerText = state.zoom.toFixed(1)+"x"; render(); };
        document.getElementById('gradOpacity').oninput = (e) => { state.gradOpacity = parseFloat(e.target.value); document.getElementById('gradVal').innerText = Math.round(state.gradOpacity*100)+"%"; render(); };
        document.getElementById('gradSpread').oninput = (e) => { state.gradSpread = parseFloat(e.target.value); document.getElementById('spreadVal').innerText = Math.round(state.gradSpread*100)+"%"; render(); };
        document.getElementById('posX').oninput = (e) => { state.posX = parseInt(e.target.value); render(); };
        document.getElementById('posY').oninput = (e) => { state.posY = parseInt(e.target.value); render(); };
        document.getElementById('titleInput').oninput = (e) => { state.title = e.target.value; render(); };
        document.getElementById('subtitleInput').oninput = (e) => { state.subtitle = e.target.value; render(); };
        
        // Métadonnées
        document.getElementById('metaAuthor').oninput = (e) => { state.meta.author = e.target.value; render(); };
        document.getElementById('metaKeywords').oninput = (e) => { state.meta.keywords = e.target.value; };
        document.getElementById('metaAlt').oninput = (e) => { state.meta.alt = e.target.value; };
        document.getElementById('metaDesc').oninput = (e) => { state.meta.description = e.target.value; };

        document.querySelectorAll('.format-btn').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('.format-btn').forEach(b => b.className = "format-btn p-3 border-2 border-gray-200 rounded-xl text-[10px] font-bold text-gray-500 transition-all");
                btn.className = "format-btn p-3 border-2 border-indigo-600 bg-indigo-50 rounded-xl text-[10px] font-bold text-indigo-700 transition-all";
                canvas.width = btn.dataset.w; canvas.height = btn.dataset.h;
                state.formatName = btn.dataset.label;
                document.getElementById('formatLabel').innerText = `Format ${state.formatName} (${btn.dataset.w}x${btn.dataset.h})`;
                state.posX = 0; state.posY = 0;
                render();
            };
        });

        // --- Export ---
        downloadBtn.onclick = () => {
            if (downloadBtn.classList.contains('btn-disabled')) return;
            const author = state.meta.author.trim().replace(/\s+/g, '_') || "Anonyme";
            const date = new Date().toISOString().split('T')[0];
            const fileName = `SocialGen_${author}_${state.formatName}_${canvas.width}x${canvas.height}-${date}.jpg`;
            
            // Simulation d'inclusion de métadonnées XMP/IPTC dans le nom du fichier ou log console
            // car le canvas.toBlob ne supporte pas nativement l'écriture EXIF sans librairie externe.
            console.log("Exportation avec métadonnées :", {
                creator: state.meta.author,
                keywords: state.meta.keywords,
                description: state.meta.description,
                altText: state.meta.alt,
                format: state.formatName,
                timestamp: new Date().toISOString()
            });

            canvas.toBlob((blob) => {
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = fileName;
                a.click();
            }, 'image/jpeg', 0.95);
        };

        window.onload = render;
    </script>
</body>
</html>
